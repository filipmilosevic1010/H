static const char script[] = 
R"(
#include "hash.h"
FILE *otvoriFajl(char *filename){
    FILE *fajl=fopen(filename, "rb+");
    if(fajl==NULL){
        printf("Fajl %s nije uspesno otvoren!\n", filename);
    }
    else{
        printf("Fajl %s uspesno otvoren!\n", filename);
    }
    return fajl;
}
void kreirajHashFajl(char *filename){
    FILE *fajl=fopen(filename, "wb+");
    if(fajl==NULL){
        printf("Fajl %s nije uspesno kreiran!\n", filename);
        return;
    }
    BUCKET *emptyBuckets = calloc(B, sizeof(BUCKET));
    fseek(fajl, 0, SEEK_SET);
    fwrite(emptyBuckets, sizeof(BUCKET),B, fajl);
    free(emptyBuckets);
    printf("Fajl %s uspesno kreiran!\n", filename);
    fclose(fajl);
}
int transformisiKljuc(int kljuc){
    return kljuc%B;
}
int sacuvajBucket(FILE *fajl, BUCKET bucket, int bucketIndex){
    fseek(fajl, sizeof(BUCKET)*bucketIndex, SEEK_SET);
    int retVal=fwrite(&bucket, sizeof(BUCKET), 1, fajl)==1;
    fflush(fajl);
    return retVal;
}
void ucitajPodatke(FILE *rasuta, FILE *serijska){
    if(rasuta==NULL || serijska==NULL){
        printf("Jedan od fajlova nije otvoren!\n");
        return;
    }
    fseek(serijska, 0, SEEK_SET);
    RECORD record;
    while(fread(&record, sizeof(RECORD), 1, serijska)){
        if(strcmp(record.IDU, "********")!=0){
            int h=transformisiKljuc(atoi(record.IDU));
            int start=h;
            int gotovo=0;
            BUCKET bucket;
            do{
                fseek(rasuta, sizeof(BUCKET)*h, SEEK_SET);
                fread(&bucket, sizeof(BUCKET), 1, rasuta);
                for(int i=0; i<FBAKETIRANJA; i++){
                    if(strcmp(bucket.records[i].IDU, record.IDU)==0 && bucket.records[i].status==ACTIVE){
                        printf("Vec postoji record sa ovim IDU!\n");
                        break;
                    }
                    else if(bucket.records[i].status==EMPTY || bucket.records[i].status==DELETED){
                        bucket.records[i]=record;
                        bucket.records[i].status=ACTIVE;
                        gotovo=1;
                        break;
                    }
                }
                if(!sacuvajBucket(rasuta, bucket, h)){
                    printf("Greska prilikom upisa bucketa!");
                }
                if(gotovo){
                    break;
                }
                h=(h+KORAK)%B;
            }while(h!=start);
        }
    }
}
void ispisiRecord(RECORD record){
    printf("IDU -> %s\n", record.IDU);
    printf("IDR -> %s\n", record.IDR);
    printf("OS -> %s\n", record.OS);
    printf("DVD -> %d-%d-%d %d:%d\n", record.DVD.dan, record.DVD.mesec, record.DVD.godina, record.DVD.sati, record.DVD.minuti);
    printf("DVD -> %d-%d-%d %d:%d\n", record.DVO.dan, record.DVO.mesec, record.DVO.godina, record.DVO.sati, record.DVO.minuti);
    printf("BRS -> %d\n", record.BRS);
    printf("Status -> ");
    if(record.status==EMPTY){
        printf("EMPTY\n");
    }
    else if(record.status==DELETED){
        printf("DELETED\n");
    }
    else{
        printf("ACTIVE\n");
    }
}
void ispisiBucket(BUCKET bucket){
    for(int i=0; i<FBAKETIRANJA; i++){
        ispisiRecord(bucket.records[i]);
    }
}
void ispisiContent(FILE *fajl){
    if(fajl==NULL){
        printf("Fajl nije otvoren!\n");
        return;
    }
    BUCKET bucket;
    for(int i=0; i<B; i++){
        fseek(fajl, i*sizeof(BUCKET), SEEK_SET);
        fread(&bucket, sizeof(BUCKET),1, fajl);
        printf("--------BUCKET %d--------\n", i);
        ispisiBucket(bucket);
    }
}
PRONADJENIRECORD pronadjiRecord(FILE *fajl, int kljuc){
    if(fajl==NULL){
        printf("Fajl nije otvoren!\n");
    }
    else{
        int h=transformisiKljuc(kljuc);
        int start=h;
        PRONADJENIRECORD retVal;
        retVal.ind1=99;
        retVal.ind2=0;
        BUCKET bucket;
        while(retVal.ind1==99){
            int q=0;
            fseek(fajl, h*sizeof(BUCKET), SEEK_SET);
            fread(&bucket, sizeof(BUCKET), 1, fajl);
            retVal.bucket=bucket;
            retVal.bucketIndex=h;

            while(q<FBAKETIRANJA && retVal.ind1==99){
                RECORD record = bucket.records[q];
                retVal.record=record;
                retVal.recordIndex=q;

                if(atoi(record.IDU)==kljuc && record.status==ACTIVE){
                    retVal.ind1=0;
                }
                else if(record.status==EMPTY){
                    retVal.ind1=1;
                }
                else{
                    q++;
                }
            }
            if(q>=FBAKETIRANJA){
                h=(h+KORAK)%B;
                if(h==start){
                    retVal.ind1=1;
                    retVal.ind2=1;
                }
            }
        }
        return retVal;
    }
}
void obrisiRecordLogicki(FILE *fajl, int kljuc){
    if(fajl==NULL){
        printf("Fajl nije otvoren!\n");
        return;
    }
    PRONADJENIRECORD pronadjeni = pronadjiRecord(fajl, kljuc);
    if(pronadjeni.ind1){
        printf("Ne postoji record sa ovim IDU!\n");
    }
    else{
        BUCKET bucket;
        fseek(fajl, pronadjeni.bucketIndex*sizeof(BUCKET), SEEK_SET);
        fread(&bucket, sizeof(BUCKET), 1, fajl);
        bucket.records[pronadjeni.recordIndex].status=DELETED;
        if(sacuvajBucket(fajl, bucket, pronadjeni.bucketIndex)){
            printf("Uspesno obrisan record logicki!\n");
        }
        else{
            printf("Neuspesno obirsan record ligicki!\n");
        }
    }
}
void modifikujRecord(FILE *fajl, RECORD record){
    if(fajl==NULL){
        printf("Fajl nije otvoren!\n");
        return;
    }
    PRONADJENIRECORD pronadjeni = pronadjiRecord(fajl, atoi(record.IDU));
    if(pronadjeni.ind1){
        printf("Ne postoji record sa ovim IDU!\n");
    }
    else{
        BUCKET bucket;
        fseek(fajl, pronadjeni.bucketIndex*sizeof(BUCKET), SEEK_SET);
        fread(&bucket, sizeof(BUCKET), 1, fajl);
        bucket.records[pronadjeni.recordIndex]=record;
        if(sacuvajBucket(fajl, bucket, pronadjeni.bucketIndex)){
            printf("Uspesna modifikacija recorda!\n");
        }
        else{
            printf("Neuspesna modifikacija recorda!\n");
        }
    }
}
void dodajRecordSaTastature(FILE *fajl, RECORD record){
    if(fajl==NULL){
        printf("Fajl nije otvoren!\n");
        return;
    }
    int h=transformisiKljuc(atoi(record.IDU));
    int start=h;
    BUCKET bucket;
    PRONADJENIRECORD pronadjeni = pronadjiRecord(fajl, atoi(record.IDU));
    if(!pronadjeni.ind1){
        printf("Postoji record sa ovim IDU!\n");
        return;
    }
    do{
        fseek(fajl, h*sizeof(BUCKET), SEEK_SET);
        fread(&bucket, sizeof(BUCKET),1 , fajl);

        for(int i=0;i<FBAKETIRANJA; i++){
            if(bucket.records[i].status!=ACTIVE){
                bucket.records[i]=record;
                bucket.records[i].status=ACTIVE;
                if(!sacuvajBucket(fajl, bucket, h)){
                    printf("Neuspesno dodavanje recorda!\n");
                }
                else{
                    printf("Uspesno dodavanje recorda!\n");
                }
                return;
            }
        }
        h=(h+KORAK)%B;
    }while(h!=start);
}
RECORD *pronadjiPoIDR(FILE *fajl, char *IDR){
    if(fajl==NULL){
        printf("Fajl nije otvoren!\n");
        return NULL;
    }
    RECORD record;
    fseek(fajl, 0, SEEK_SET);
    while(fread(&record, sizeof(RECORD),1 , fajl)){
        if(strcmp(record.IDR, IDR)==0 && record.status==ACTIVE){
            RECORD *pronadjeni = (RECORD*)malloc(sizeof(RECORD));
            memcpy(pronadjeni, &record, sizeof(RECORD));
            return pronadjeni;
        }
    }
    return NULL;
}
//
#include <stdio.h>
#include <stdlib.h>
#include "hash.h"

int main()
{
    char *ime_rasute="rasuta.dat";
    char *ime_serijske="serijska.dat";
    FILE *serijska=otvoriFajl(ime_serijske);
    kreirajHashFajl(ime_rasute);
    FILE *rasuta=otvoriFajl(ime_rasute);
    ucitajPodatke(rasuta,serijska);
    ispisiContent(rasuta);
    obrisiRecordLogicki(rasuta, 1001);

    RECORD record1;
            printf("Unesi IDU: ");
            scanf("%s", record1.IDU);
            printf("Unesi IDR: ");
            scanf("%s", record1.IDR);
            printf("Unesi OS: ");
            scanf("%s", record1.OS);
            printf("Unesi DVD(DD-MM-GG SS:MM): ");
            scanf("%d-%d-%d %d:%d", &record1.DVD.dan, &record1.DVD.mesec, &record1.DVD.godina, &record1.DVD.sati, &record1.DVD.minuti);
            printf("Unesi DVO(DD-MM-GG SS:MM): ");
            scanf("%d-%d-%d %d:%d", &record1.DVO.dan, &record1.DVO.mesec, &record1.DVO.godina, &record1.DVO.sati, &record1.DVO.minuti);
            printf("Unesi BRS: ");
            scanf("%d", &record1.BRS);
            modifikujRecord(rasuta, record1);


    dodajRecordSaTastature(rasuta, record1);
    RECORD *r = pronadjiPoIDR(rasuta, "1234567890123");
    PRONADJENIRECORD p = pronadjiRecord(rasuta, 1001);
    fclose(serijska);
    fclose(rasuta);
    return 0;
}
//
#ifndef BUCKET_H_INCLUDED
#define BUCKET_H_INCLUDED
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define FBAKETIRANJA 3
#define B 4
#define KORAK 1
typedef enum { EMPTY=0, ACTIVE, DELETED} STATUS;
typedef struct DateTime{
    int dan;
    int mesec;
    int godina;
    int sati;
    int minuti;
}DATETIME;
typedef struct Record{
    char IDU[8];
    char IDR[14];
    char OS[4];
    DATETIME DVD;
    DATETIME DVO;
    int BRS;
    STATUS status;
}RECORD;
typedef struct Bucket{
    RECORD records[FBAKETIRANJA];
}BUCKET;
typedef struct PronadjeniRecord{
    int ind1;
    int ind2;
    BUCKET bucket;
    RECORD record;
    int bucketIndex;
    int recordIndex;
}PRONADJENIRECORD;
#endif // BUCKET_H_INCLUDED
TO JE TO MAJMUNE
)";
